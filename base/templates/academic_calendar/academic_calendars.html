{% extends "layout.html" %}

{% load static i18n dictionnary format%}

{% get_current_language as LANGUAGE_CODE %}

{% comment "License" %}
 * OSIS stands for Open Student Information System. It's an application
 * designed to manage the core business of higher education institutions,
 * such as universities, faculties, institutes and professional schools.
 * The core business involves the administration of students, teachers,
 * courses, programs and so on.
 *
 * Copyright (C) 2015-2019 Universit√© catholique de Louvain (http://www.uclouvain.be)
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * A copy of this license - GNU General Public License - is available
 * at the root of the source code of this program.  If not,
 * see http://www.gnu.org/licenses/.
{% endcomment %}

{% block style %}
    <link rel="stylesheet" href="{% static 'css/toggle-switch.css' %}">
{% endblock %}

{% block breadcrumb %}
  <li><a href="{% url 'institution' %}" id="lnk_institution">{% trans 'Institution'%}</a></li>
  <li class="active">{% trans 'Academic calendars'%}</li>

{% endblock %}
{% block content %}
<div class="page-header">
  <h2>{% trans 'Academic calendar' %}</h2>
</div>
<div class="panel panel-default">
  <div class="panel-body">
    <div class="row">

    </div>
    <br>
    <div id="gantt">
      <div id="gantt_div">
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block script %}
    <script src="{% static 'dhtmlxGantt/dhtmlxgantt.js' %}"></script>
    <script src="{% static 'dhtmlxGantt/ext/dhtmlxgantt_tooltip.js' %}"></script>
    <script src="{% static 'dhtmlxGantt/ext/dhtmlxgantt_marker.js' %}"></script>
    <link href="{% static 'dhtmlxGantt/dhtmlxgantt.css' %}" rel="stylesheet">
    {% if LANGUAGE_CODE == 'fr-be' %}
        <script src="{% static 'dhtmlxGantt/locale/locale_fr.js' %}" charset="utf-8"></script>
    {% endif %}

    <script type="text/javascript">
        function formatDate(date){
            month = date.getMonth() + 1;
            return date.getDate() + "/" + month + "/" + date.getFullYear()
        }

        gantt.config.scale_unit = "year";
        gantt.config.date_scale = "%Y";
        gantt.config.subscales = [
            {unit:"month", step:1, date:"%F" }
        ];

        gantt.config.readonly = true;
        gantt.config.columns = [
            {name:"text", label:" ", width:"*", align: "left", tree:true},
        ];

        gantt.config.tooltip_offset_y = -20;
        gantt.config.tooltip_hide_timeout = 2000;
        gantt.templates.tooltip_text = function(start,end,row){
           let domElem = '';
           if (!row.divider){
               domElem = "<b>" + row.tooltip_text + "</b><br>"
                + formatDate(row.start_date) + " - " + formatDate(row.end_date)
                //+ "<a href=\"{% url 'academic_calendars' %}" + task.id + "\">"
                + "<br>{% trans 'Details'%}</a>";
           }
           return domElem;
        };

        const todayMarker = gantt.addMarker({
            start_date: new Date(),
            text: "{% trans "Today" %}"
        });
        gantt.config.autosize = "y";
        gantt.config.scroll_on_click= false;
        gantt.init("gantt_div");
        gantt.parse({
            'data': {{ gantt_rows|safe }}
        }, "json");
    </script>
{% endblock %}
